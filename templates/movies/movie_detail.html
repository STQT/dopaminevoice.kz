{% extends "base.html" %}
{% load movie_tags %}
{% block extra_head %}
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
    <style>
        body {
            margin-top: 20px;
        }

        /*==================================================
          Post Contents CSS
          ==================================================*/

        .post-content img.post-image, video.post-video, .google-maps {
            width: 100%;
            height: auto;
        }

        .post-content .google-maps .map {
            height: 300px;
        }


        .post-content .post-container .post-detail .reaction {
            position: absolute;
            right: 0;
            top: 0;
        }

        .post-content .post-container .post-detail .post-comment {
            display: inline-flex;
            margin: 10px auto;
            width: 100%;
        }

        .post-content .post-container .post-detail .post-comment img.profile-photo-sm {
            margin-right: 10px;
        }

        .post-content .post-container .post-detail .post-comment .form-control {
            height: 30px;
            border: 1px solid #ccc;
            box-shadow: inset 0 1px 1px rgba(0, 0, 0, .075);
            margin: 7px 0;
            min-width: 0;
        }

        img.profile-photo-md {
            height: 50px;
            width: 50px;
            border-radius: 50%;
        }

        img.profile-photo-sm {
            height: 40px;
            width: 40px;
            border-radius: 50%;
        }

        .text-green {
            color: #8dc63f;
        }

        .text-red {
            color: #ef4136;
        }

        .following {
            color: #8dc63f;
            font-size: 12px;
            margin-left: 20px;
        }
    </style>
{% endblock %}
{% block content %}
    <div class="anime__details__content">
        <div class="row">
            <div class="col-lg-3">
                <div class="anime__details__pic set-bg" data-setbg="{{ object.img.url }}">
                </div>
            </div>
            <div class="col-lg-9">
                <div class="anime__details__text">
                    <div class="anime__details__title">
                        <h3>{{ object.title }}</h3>
                        <span> {{ object.original_title }}</span>
                    </div>
                    <p>{{ object.description }}</p>
                    <div class="anime__details__widget">
                        <div class="row">
                            <div class="col-lg-6 col-md-6">
                                <ul>
                                    <li><span>Тип:</span> {{ object.get_status_display }}</li>
                                    <li><span>Студия:</span> {{ object.studia }}</li>
                                    <li><span>Жанр:</span> {% for tag in object.genre.get_queryset %}
                                        {{ tag.title }},
                                    {% endfor %}
                                    </li>
                                </ul>
                            </div>
                            <div class="col-lg-6 col-md-6">
                                <ul>
                                    <li><span>Прокат:</span> {{ movie.prokat }}</li>
                                    <li><span>Бөлім саны:</span> {{ movie.max_series }}</li>
                                    <li><span>Уақыты:</span> {{ movie.duration }}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12">
                {% if many == False %}
                    <div class="anime__video__player">
                        <p>Иш зат жоқ</p>
                    </div>
                {% else %}
                    {% if movie.full_length == True %}
                        <div id="player"></div>
                        <iframe width="100%" height="384" src="{{ episode.iframe_link }}" frameborder="0"
                                allow="autoplay" allowfullscreen></iframe>
                    {% else %}
                        <div class="anime__details__episodes">
                            <div class="section-title">
                                <h5>1 Маусым</h5>
                            </div>
                            {% for seriya in episode %}
                                {% if view.kwargs.seriya == seriya.number %}
                                    <a href="#" style="background-color: #e53637;">{{ seriya.number }} БӨЛІМ</a>
                                {% else %}
                                    <a href="{{ seriya.get_episode_url }}">{{ seriya.number }} БӨЛІМ</a>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <div class="anime__video__player">
                            <div id="player"></div>
                            <iframe width="100%" height="384"
                                    src="{{ current_episode.iframe_link }}" frameborder="0"
                                    allow="autoplay" allowfullscreen></iframe>
                        </div>
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
{#    TODO: REMOVE DUBLICATE QUERY CHANGE#}
    <h3 style="color: white; margin-bottom: 20px;">Пікірлер ({{ comments_count }}):</h3>
    <div id="vk_comments"></div>
    <section>
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <div class="line-divider"></div>

                    <div class="pagination">
                    <span class="step-links">
                    {% for comment in comments %}
                        <div class="post-comment">
{#                            <img src="https://bootdey.com/img/Content/avatar/avatar7.png" alt=""#}
{#                                 class="profile-photo-sm">#}
{#                            <p>#}
                                <a href="#" class="profile-link">
                                <strong> {{ comment.author.get_short_name }}<br/></strong>
                                </a>
                                <i class="em em-laughing"></i> {{ comment.comment }} </p>
                            <div class="reaction">
                                <p>
                                    <a class="btn">
                                        <i class="fa fa-thumbs{% if not liked %}-o{% endif %}-up"></i> {{ comment.user_likes.count }}
                                    </a>
                                    <a class="btn">
                                        <i class="fa fa-thumbs{% if not liked %}-o{% endif %}-down"></i> {{ comment.user_dislikes.count }}
                                    </a>
                                    <i class="fa fa-calendar"> </i> {{ comment.created_at }}
                                </p>
                            </div>
                        </div>
                    {% endfor %}
                        {% if comments.has_previous %}
                            <a href="?page=1">&laquo; first</a>
                            <a href="?page={{ comments.previous_page_number }}">previous</a>
                        {% endif %}

                        <span class="current">
                            Page {{ comments.number }} of {{ comments.paginator.num_pages }}.
                        </span>
                        {% if comments.has_next %}
                            <a href="?page={{ comments.next_page_number }}">next</a>
                            <a href="?page={{ comments.paginator.num_pages }}">last &raquo;</a>
                        {% endif %}
                    </span>
                    </div>
                    {% if user.is_authenticated %}
                        <div class="post-comment">
                            {#                        <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt=""#}
                            {#                             class="profile-photo-sm">#}

                            {#                            <form class="row" action="{% url 'movies:add_comment' 1 %}">#}
                            {#                                {% csrf_token %}#}
                            {#                                <input type="text" class="form-control" placeholder="Пікір жазу"/>#}
                            {#                                <button type="submit" class="btn btn-success">Жіберу</button>#}
                            {#                            </form>#}
                            <form class="row" action="{% url 'movies:movie_seriya_detail' current_episode.movie.url current_episode.number %}" method="post">
                                {% csrf_token %}
                                {#    {{ form }}#}
                                <label for="id_comment">Comment:</label>
                                <input name="comment" cols="40" rows="3" required id="id_comment"></input>
                                {#    <textarea id="id_comment" name="id_comment" class="form-control" placeholder="Пікір жазу"></textarea>#}
                                <button type="submit" class="btn btn-success">Жіберу</button>
                            </form>
                        </div>
                    {% else %}
                        <p>Пікір қалдыру ушін сайтқа кіріңіз
                            <a href="{% url "account_login" %}" class="btn btn-info">
                                Кіру
                            </a>
                        </p>
                    {% endif %}
                </div>
            </div>
        </div>
    </section>
{% endblock %}